<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#00d4aa">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WalkStory">
  <title>WalkStory · 걸음으로 키우는 나만의 동물 친구</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="./walkstory-logo.png">
  <link rel="apple-touch-icon" href="./walkstory-logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;600;700&display=swap" rel="stylesheet">
  <script src="config.js"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    // Capacitor 감지 (모바일 앱 환경 확인)
    // 더 강력한 감지 로직: 여러 방법으로 확인
    window.isCapacitorApp = typeof window !== 'undefined' && (
      window.Capacitor !== undefined ||
      window.capacitor !== undefined ||
      (window.location && (
        window.location.protocol === 'capacitor:' ||
        window.location.protocol === 'http:' && window.location.hostname === 'localhost' && navigator.userAgent.includes('Android')
      )) ||
      (navigator.userAgent && (
        navigator.userAgent.includes('Capacitor') ||
        (navigator.userAgent.includes('Android') && window.location && window.location.hostname === 'localhost')
      ))
    );
    
    // 디버깅용 로그
    if (typeof window !== 'undefined') {
      console.log('Capacitor detection:', {
        Capacitor: window.Capacitor !== undefined,
        capacitor: window.capacitor !== undefined,
        protocol: window.location ? window.location.protocol : 'N/A',
        hostname: window.location ? window.location.hostname : 'N/A',
        userAgent: navigator.userAgent,
        isCapacitorApp: window.isCapacitorApp
      });
    }
    
    // 카카오 SDK 초기화 (모바일 앱과 웹 모두에서 사용)
    if (typeof window !== 'undefined' && window.APP_CONFIG && window.APP_CONFIG.kakao && typeof Kakao !== 'undefined') {
      try {
        Kakao.init(window.APP_CONFIG.kakao.javascriptKey);
        console.log('Kakao SDK initialized');
      } catch (e) {
        console.error('Kakao SDK 초기화 오류:', e);
      }
    }
  </script>
  <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="night">
  <div class="container">
    <div id="appMain" class="hidden">
    <header>
      <button type="button" class="theme-toggle" id="themeToggle" title="모닝/나이트 전환">🌙</button>
      <h1>WalkStory</h1>
      <p class="subtitle">걸음으로 키우는 나만의 동물 친구</p>
      <div class="header-level" id="headerLevel">
        <span>Lv.<span class="lv-num" id="levelNum">1</span></span>
        <div class="level-bar-wrap"><div class="level-bar-fill" id="levelBarFill" style="width:0%"></div></div>
      </div>
      <p class="title-badge" id="titleBadge">산책러</p>
      <div class="header-right">
        <button type="button" class="header-auth-btn" id="btnHeaderAuth" aria-label="로그인">🔐 로그인</button>
        <button type="button" class="header-logout-btn" id="btnLogout" aria-label="로그아웃" style="display:none;">로그아웃</button>
        <span class="gold-display">🪙 <span id="headerGold">0</span> G</span>
      </div>
    </header>

    <nav class="tab-nav" role="tablist">
      <button type="button" class="tab-btn active" data-tab="walk" aria-selected="true"><span class="tab-emoji">🚶</span>산책</button>
      <button type="button" class="tab-btn" data-tab="avatar"><span class="tab-emoji">🧑</span>아바타</button>
      <button type="button" class="tab-btn" data-tab="storage"><span class="tab-emoji">📥</span>보관함</button>
      <button type="button" class="tab-btn" data-tab="shop"><span class="tab-emoji">🛒</span>상점</button>
      <button type="button" class="tab-btn" data-tab="equipment"><span class="tab-emoji">🎒</span>장비</button>
      <button type="button" class="tab-btn" data-tab="social"><span class="tab-emoji">👥</span>친구</button>
      <button type="button" class="tab-btn" data-tab="story"><span class="tab-emoji">📖</span>스토리</button>
    </nav>

    <!-- 산책 탭 (걸음 + 코스 + 지도 + 산책로 통합) -->
    <section class="page active" id="page-walk" role="tabpanel">
      <div class="attendance-card" id="attendanceCard" style="display:none;">
        <h2 class="walk-title">📅 출석 이벤트</h2>
        <p class="attendance-desc">매일 출석하고 보상을 받아가요. 7일 연속 시 <strong>위클리 마스터 선물상자</strong> 지급!</p>
        <div class="attendance-status" id="attendanceStatus"></div>
        <button type="button" class="btn-attendance" id="btnAttendance" style="display:none;">출석 체크</button>
      </div>
      <div class="quest-card">
        <h2 class="walk-title">📋 오늘의 퀘스트</h2>
        <p class="quest-desc">완료 후 보상을 수령하면 골드를 받을 수 있어요.</p>
        <div id="questList" class="quest-list"></div>
      </div>
      <div class="step-card" id="stepCard">
        <div class="step-value-wrap">
          <span class="step-value" id="stepValue">0</span>
          <span class="step-unit">걸음</span>
        </div>
        <p class="step-label">오늘 걸은 걸음</p>
        <p class="lifetime-hint">누적 <span id="lifetimeSteps">0</span>걸음으로 산책로를 열어가요</p>
        <div class="progress-wrap">
          <div class="progress-header">
            <span>오늘 목표</span>
            <span id="progressText">0 / 10,000</span>
          </div>
          <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progressFill"></div>
          </div>
        </div>
        <div class="goal-badge" id="goalBadge">🎉 목표 달성!</div>
        <div class="manual-area" style="display: none;">
          <!-- 버튼으로 걸음 수 추가 기능 제거됨 - 실제 걸어야만 거리가 기록됩니다 -->
        </div>
      </div>
      <p class="status" id="status">준비 중...</p>
      <div class="actions">
        <button type="button" class="btn-reset" id="btnReset">오늘 걸음 초기화</button>
      </div>
      <div class="walk-card">
        <h2 class="walk-title">나만의 산책 코스</h2>
        <div class="walk-route-select">
          <label>진행할 코스 선택</label>
          <select id="selectActiveRoute">
            <option value="">-- 코스를 선택하세요 --</option>
          </select>
          <button type="button" class="btn-add-route" id="btnAddRoute">+ 새 코스 만들기</button>
        </div>
        <div class="route-create-card" id="routeCreateCard" style="display:none;">
          <label class="course-label">코스 이름</label>
          <input type="text" id="newRouteName" placeholder="예: 동네 한 바퀴" class="course-input" maxlength="20" inputmode="text" />
          <label class="course-label">목표 거리 (km, 최소 0.5)</label>
          <input type="number" id="newRouteGoalKm" min="0.5" max="50" step="0.5" value="1" class="course-input" inputmode="decimal" />
          <button type="button" class="btn-walk-start" id="btnSaveRoute" style="margin-top:0.5rem;">저장</button>
        </div>
        <div class="walk-actions">
          <button type="button" class="btn-walk-start" id="btnWalkStart">산책 시작</button>
          <button type="button" class="btn-walk-stop" id="btnWalkStop" disabled>산책 종료</button>
        </div>
      <div class="walk-live" id="walkLive">
          <div class="walk-stat"><span class="walk-stat-value" id="walkDistance">0.00</span> km</div>
          <div class="walk-stat">속도 <span class="walk-stat-value" id="walkSpeed">0.0</span> km/h</div>
          <div class="walk-stat">XP <span class="walk-stat-value" id="walkXp">0</span></div>
          <div class="walk-stat walk-total">총 이동 거리 <span class="walk-stat-value" id="walkTotalKm">0.00</span> km</div>
          <div class="walk-next" id="walkNext">코스를 완주하면 보급 키트가 보관함에 도착해요!</div>
          <div class="walk-next" id="walkRace" style="margin-top:0.25rem;"></div>
        </div>
        <div id="walkMap" class="our-map-wrap"></div>
        <p class="walk-status" id="walkStatus">코스를 선택하고 산책 시작을 누르세요.</p>
      </div>
      <p class="inventory-title">내 산책 코스</p>
      <div id="routesMap" class="our-map-wrap routes-map-box" style="height:180px;margin-bottom:1rem;"></div>
      <div class="route-list" id="routeList"></div>
    </section>

    <!-- 아바타 탭 -->
    <section class="page" id="page-avatar" role="tabpanel">
      <div class="avatar-section">
        <p class="avatar-name" id="avatarName">산책러</p>
        <div class="avatar-3d-placeholder" id="avatar3dPlaceholder">
          <span class="ph-title">3D 캐릭터 영역 (Unity WebGL 연동)</span>
          <span class="ph-desc">Unity로 만든 캐릭터를 넣을 수 있어요. WebGL 빌드 후 이 영역에 canvas를 넣고, UNITY_연동_가이드.md를 참고해 연동하세요.<br>아래는 2D 미리보기입니다.</span>
        </div>
        <div class="avatar-preview-wrap">
          <div class="avatar-human" id="avatarHuman">
            <div class="ah-head" id="previewHead" style="background:var(--skin,#f5d0b0)"></div>
            <div class="ah-face"><span class="eye"></span><span class="eye"></span></div>
            <div class="ah-neck" style="background:var(--skin,#f5d0b0)"></div>
            <div class="ah-torso" id="previewBody" style="background:var(--top-color,#6b7280)"></div>
            <div class="ah-arm-l" id="previewArmL" style="background:var(--skin,#f5d0b0)"></div>
            <div class="ah-arm-r" id="previewArmR" style="background:var(--skin,#f5d0b0)"></div>
            <div class="ah-leg-l" id="previewLegL" style="background:var(--bottom-color,#4b5563)"></div>
            <div class="ah-leg-r" id="previewLegR" style="background:var(--bottom-color,#4b5563)"></div>
            <div class="ah-slot-head" id="previewHat"></div>
            <div class="ah-slot-accessory" id="previewWeapon"></div>
          </div>
        </div>
        <div class="pet-section" id="petSection">
          <p class="customize-section-title">나만의 동물 친구</p>
          <div class="pet-display" id="petDisplay">
            <div class="pet-preview" id="petPreview">
              <div class="pet-emoji" id="petEmoji" style="font-size: 4rem;">🐾</div>
              <div class="pet-info" id="petInfo">
                <div class="pet-name" id="petName">동물을 선택해주세요</div>
                <div class="pet-level" id="petLevel">Lv.1</div>
                <div class="pet-exp-bar">
                  <div class="pet-exp-fill" id="petExpFill" style="width: 0%"></div>
                </div>
                <div class="pet-exp-text" id="petExpText">경험치: 0 / 100</div>
              </div>
            </div>
            <button type="button" class="btn-select-pet" id="btnSelectPet">동물 선택하기</button>
          </div>
        </div>
        <p class="customize-section-title">기본 정보</p>
        <div class="customize-row">
          <label>이름</label>
          <input type="text" id="inputAvatarName" placeholder="이름 입력" maxlength="8" inputmode="text" autocomplete="name" />
        </div>
        <p class="customize-section-title">외형</p>
        <div class="customize-row">
          <label>피부색</label>
          <div style="display:flex;gap:0.35rem;flex-wrap:wrap;">
            <button type="button" class="color-swatch active" data-skin="#f5d0b0" style="background:#f5d0b0" aria-label="피부색 1"></button>
            <button type="button" class="color-swatch" data-skin="#e8b896" style="background:#e8b896" aria-label="피부색 2"></button>
            <button type="button" class="color-swatch" data-skin="#d4a574" style="background:#d4a574" aria-label="피부색 3"></button>
            <button type="button" class="color-swatch" data-skin="#c4956a" style="background:#c4956a" aria-label="피부색 4"></button>
          </div>
        </div>
        <p class="customize-section-title">머리</p>
        <div class="customize-row">
          <label>스타일</label>
          <select id="selectHair">
            <option value="short">짧은 머리</option>
            <option value="long">긴 머리</option>
            <option value="curly">곱슬머리</option>
            <option value="spiky">뻗친 머리</option>
          </select>
        </div>
        <div class="customize-row">
          <label>머리 색</label>
          <div style="display:flex;gap:0.35rem;flex-wrap:wrap;">
            <button type="button" class="color-swatch hair-color active" data-hair="#4a3728" style="background:#4a3728"></button>
            <button type="button" class="color-swatch hair-color" data-hair="#2c1810" style="background:#2c1810"></button>
            <button type="button" class="color-swatch hair-color" data-hair="#8b6914" style="background:#8b6914"></button>
            <button type="button" class="color-swatch hair-color" data-hair="#5c4033" style="background:#5c4033"></button>
          </div>
        </div>
      </div>
    </section>

    <!-- 보관함 탭 -->
    <section class="page" id="page-storage" role="tabpanel">
      <div class="walk-card">
        <h2 class="walk-title">📥 보관함</h2>
        <p class="story-text" style="font-size:0.85rem;color:var(--text-muted);margin-bottom:1rem;">산책 코스 완주 시 받은 보급 키트가 여기로 옵니다. 인벤으로 가져가거나 바로 열 수 있어요.</p>
        <div class="inventory-slot-list" id="storageList"></div>
      </div>
    </section>

    <!-- 상점 탭 (보급 + 공유 + 결제) -->
    <section class="page" id="page-shop" role="tabpanel">
      <div class="gacha-card">
        <h2 class="walk-title">📦 보급 뽑기</h2>
        <p class="gacha-gold">🪙 <span id="gachaGold">0</span> G</p>
        <div class="gacha-buttons">
          <button type="button" class="btn-gacha" id="btnGacha">1회 뽑기 (30 G)</button>
          <button type="button" class="btn-gacha-premium" id="btnGachaPremium">강화 뽑기 (60 G)</button>
        </div>
        <p class="gacha-cost">강화 뽑기는 좋은 등급·희귀도 확률 상승</p>
      </div>
      <div class="share-card">
        <h2 class="walk-title">🔗 링크 공유 보상</h2>
        <p class="story-text" style="font-size:0.85rem;margin-bottom:0.75rem;">카카오톡 등으로 공유하면 <strong>+40 G</strong> (일 1회)</p>
        <button type="button" class="btn-share" id="btnShare">카카오톡으로 공유하고 40 G 받기</button>
      </div>
      <div class="payment-card">
        <h2 class="walk-title">💳 골드 구매</h2>
        <p class="payment-desc">스토어 연동 후 사용 가능합니다.</p>
        <div class="payment-grid">
          <div class="payment-item-card">
            <span class="payment-amount">100 G</span>
            <span class="payment-price">소액</span>
            <button type="button" class="btn-payment" disabled>준비 중</button>
          </div>
          <div class="payment-item-card">
            <span class="payment-amount">500 G</span>
            <span class="payment-price">인기</span>
            <button type="button" class="btn-payment" disabled>준비 중</button>
          </div>
          <div class="payment-item-card highlight">
            <span class="payment-amount">1,200 G</span>
            <span class="payment-price">20% 보너스</span>
            <button type="button" class="btn-payment" disabled>준비 중</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 장비 탭 (착용/보유 + 강화) -->
    <section class="page" id="page-equipment" role="tabpanel">
      <div class="equipped-section">
        <p class="equipped-title">착용 중 (탭하여 변경)</p>
        <div class="equipped-slots" id="equippedSlots"></div>
        <div class="equip-bonus-summary" id="equipBonusSummary"></div>
      </div>
      <p class="inventory-title">장비 칸별 보유 목록 (탭하면 착용)</p>
      <div id="inventoryBySlot"></div>
      <div class="walk-card" style="margin-top:1.25rem;">
        <h2 class="walk-title">⬆️ 장비 강화</h2>
        <div class="enhance-table-wrap">
          <table class="enhance-table" aria-label="강화 성공률">
            <thead>
              <tr><th>강화</th><th>성공 확률</th><th>시도/실패 시</th></tr>
            </thead>
            <tbody id="enhanceTableBody"></tbody>
          </table>
        </div>
        <p class="course-label">강화할 장비 선택</p>
        <select class="enhance-select" id="enhanceSelect">
          <option value="">-- 장비 선택 --</option>
        </select>
        <button type="button" class="btn-enhance" id="btnEnhance">강화 시도</button>
        <p class="enhance-note">1~3강 실패 시 장비 파괴. 4~7강은 시도할 때 골드를 먼저 차감하고, 실패해도 장비는 유지돼요.</p>
      </div>
    </section>

    <!-- 친구/채팅 탭 -->
    <section class="page" id="page-social" role="tabpanel">
      <div class="social-tabs">
        <button type="button" class="social-tab-btn active" data-social-tab="friends">👥 친구</button>
        <button type="button" class="social-tab-btn" data-social-tab="chat">💬 채팅</button>
        <button type="button" class="social-tab-btn" data-social-tab="party">🎉 파티</button>
      </div>

      <!-- 친구 탭 -->
      <div class="social-content" id="social-friends">
        <div class="walk-card">
          <h2 class="walk-title">친구 검색</h2>
          <div style="display:flex;gap:0.5rem;margin-bottom:1rem;">
            <input type="text" id="friendSearchInput" placeholder="닉네임으로 검색" class="course-input" style="flex:1;" />
            <button type="button" class="btn-walk-start" id="btnFriendSearch" style="padding:0.65rem 1rem;">검색</button>
          </div>
          <div id="friendSearchResults"></div>
        </div>
        <div class="walk-card">
          <h2 class="walk-title">친구 요청</h2>
          <div id="friendRequestsList"></div>
        </div>
        <div class="walk-card">
          <h2 class="walk-title">내 친구 목록</h2>
          <div id="friendsList"></div>
        </div>
      </div>

      <!-- 채팅 탭 -->
      <div class="social-content" id="social-chat" style="display:none;">
        <div class="walk-card">
          <h2 class="walk-title">채팅 목록</h2>
          <div id="chatList"></div>
        </div>
        <div class="walk-card" id="chatRoom" style="display:none;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
            <h2 class="walk-title" id="chatRoomTitle" style="margin:0;"></h2>
            <button type="button" class="btn-chat-close" id="btnCloseChat">닫기</button>
          </div>
          <div id="chatMessages" style="max-height:400px;overflow-y:auto;margin-bottom:1rem;padding:0.75rem;background:var(--bg-soft);border-radius:var(--radius);min-height:200px;"></div>
          <div style="display:flex;gap:0.5rem;">
            <input type="text" id="chatMessageInput" placeholder="메시지 입력..." class="course-input" style="flex:1;" />
            <button type="button" class="btn-walk-start" id="btnSendMessage" style="padding:0.65rem 1rem;">전송</button>
          </div>
        </div>
      </div>

      <!-- 파티 탭 -->
      <div class="social-content" id="social-party" style="display:none;">
        <div class="walk-card">
          <h2 class="walk-title">내 파티</h2>
          <div id="partyInfo"></div>
          <div style="margin-top:1rem;">
            <button type="button" class="btn-walk-start" id="btnCreateParty" style="width:100%;">새 파티 만들기</button>
            <button type="button" class="btn-walk-stop" id="btnLeaveParty" style="width:100%;margin-top:0.5rem;display:none;">파티 나가기</button>
          </div>
        </div>
        <div class="walk-card">
          <h2 class="walk-title">파티 멤버</h2>
          <div id="partyMembers"></div>
          <div id="partyInviteSection" style="display:none;margin-top:1rem;">
            <h3 style="font-size:0.9rem;color:var(--text);margin-bottom:0.75rem;">친구 초대</h3>
            <div id="partyInviteFriends" style="max-height:200px;overflow-y:auto;"></div>
          </div>
        </div>
        <div class="walk-card">
          <h2 class="walk-title">파티 보너스</h2>
          <p class="story-text" style="font-size:0.85rem;color:var(--text-muted);">
            파티와 함께 산책하면 XP 보너스를 받을 수 있어요!<br/>
            멤버 수에 따라 보너스: 2명 (+10%), 3명 (+20%), 4명 (+30%)
          </p>
        </div>
      </div>
    </section>

    <!-- 스토리 탭 -->
    <section class="page" id="page-story" role="tabpanel">
      <div class="story-section">
        <p class="story-title">나의 산책 일지</p>
        <div class="story-text" id="storyText"></div>
        <p class="story-milestone" id="storyMilestone"></p>
        <div class="achievement-section">
          <p class="achievement-title">🏆 업적</p>
          <div class="achievement-grid" id="achievementGrid"></div>
        </div>
        <div class="animal-collection-section" style="margin-top: 2rem;">
          <p class="achievement-title">🦋 동물 컬렉션</p>
          <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 1rem;">산책 중 발견한 동물들을 모아보세요!</p>
          <div class="animal-collection-grid" id="animalCollectionGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem;"></div>
        </div>
      </div>
    </section>
    </div>

    <!-- 도감 플로팅 버튼 -->
    <button type="button" class="codex-fab" id="btnCodex" aria-label="도감 열기">📚</button>

    <!-- 도감 모달 -->
    <div class="codex-overlay" id="codexOverlay" role="dialog" aria-modal="true" aria-labelledby="codexTitle">
      <div class="codex-modal">
        <button type="button" class="codex-close" id="codexClose">×</button>
        <div class="codex-title" id="codexTitle">도감</div>
        <div class="codex-tabs">
          <button type="button" class="codex-tab active" data-codex-tab="equip" id="codexTabEquip">장비 도감</button>
          <button type="button" class="codex-tab" data-codex-tab="animal" id="codexTabAnimal">동물 도감</button>
        </div>
        <div class="codex-body">
          <div id="codexEquipPanel">
            <p class="codex-section-title">보급/강화로 얻을 수 있는 장비들</p>
            <div class="codex-grid" id="codexEquipGrid"></div>
          </div>
          <div id="codexAnimalPanel" style="display:none;">
            <p class="codex-section-title">야생에서 만날 수 있는 동물들</p>
            <div class="codex-grid" id="codexAnimalGrid"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 로그인/회원가입 (비로그인 시 첫 화면, 로그인 후 메인만 표시) -->
    <!-- 튜토리얼 모달 -->
    <div class="tutorial-modal" id="tutorialModal" style="display: none;">
      <div class="tutorial-content" style="background: var(--card); border-radius: var(--radius-lg); padding: 2rem; max-width: 400px; width: 90%; position: relative; animation: slideUp 0.4s ease;">
        <button type="button" class="tutorial-close" id="tutorialClose" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer;">×</button>
        <div class="tutorial-slide" id="tutorialSlide">
          <div class="tutorial-icon" id="tutorialIcon" style="font-size: 4rem; text-align: center; margin-bottom: 1rem;">👋</div>
          <div class="tutorial-title" id="tutorialTitle" style="font-size: 1.25rem; font-weight: 600; text-align: center; margin-bottom: 0.5rem;">WalkStory에 오신 것을 환영합니다!</div>
          <div class="tutorial-text" id="tutorialText" style="color: var(--text-muted); text-align: center; margin-bottom: 1.5rem; line-height: 1.6;"></div>
          <div class="tutorial-progress" id="tutorialProgress" style="text-align: center; margin-bottom: 1rem; font-size: 0.85rem; color: var(--text-muted);"></div>
          <div class="tutorial-buttons" style="display: flex; gap: 0.5rem;">
            <button type="button" class="btn-tutorial-prev" id="btnTutorialPrev" style="flex: 1; background: var(--bg-soft); color: var(--text); border: none; border-radius: var(--radius); padding: 0.75rem; font-weight: 600; cursor: pointer; display: none;">이전</button>
            <button type="button" class="btn-tutorial-next" id="btnTutorialNext" style="flex: 1; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius); padding: 0.75rem; font-weight: 600; cursor: pointer;">다음</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 환영 모달 -->
    <div class="welcome-modal" id="welcomeModal">
      <div class="welcome-content">
        <div class="welcome-icon">🎉</div>
        <div class="welcome-title" id="welcomeTitle">환영합니다!</div>
        <div class="welcome-message" id="welcomeMessage">로그인 성공</div>
        <button type="button" class="btn-welcome-close" id="btnWelcomeClose">시작하기</button>
      </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div class="auth-loading" id="authLoading">
      <div class="auth-loading-spinner"></div>
      <div class="auth-loading-text" style="color: var(--text-muted); font-size: 0.9rem;">처리 중...</div>
    </div>

    <!-- 모바일 닉네임 입력 모달 -->
    <div class="auth-overlay" id="mobileNicknameOverlay" style="display: none;">
      <div class="auth-modal" style="max-width: 400px;">
        <h2 class="auth-title">WalkStory 시작하기</h2>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; text-align: center;">
          닉네임을 입력해 주세요.<br/>자동으로 계정이 생성됩니다.
        </p>
        <div class="auth-panel">
          <label>닉네임</label>
          <input type="text" id="mobileNicknameInput" placeholder="2~12자" maxlength="12" inputmode="text" autocomplete="username" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--bg); color: var(--text); font-size: 1rem;" />
          <button type="button" class="btn-auth-submit" id="btnMobileNicknameSubmit" style="width: 100%; margin-top: 1rem;">시작하기</button>
        </div>
      </div>
    </div>

    <div class="auth-overlay auth-gate" id="authOverlay" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="auth-modal">
        <div class="auth-tabs">
          <button type="button" class="auth-tab active" data-auth-tab="login">로그인</button>
          <button type="button" class="auth-tab" data-auth-tab="signup">회원가입</button>
        </div>
        <h2 class="auth-title" id="authTitle">로그인</h2>
        <div id="authLoginPanel" class="auth-panel">
          <label>닉네임</label>
          <input type="text" id="authLoginNick" placeholder="닉네임" maxlength="12" inputmode="text" autocomplete="username" />
          <label>비밀번호</label>
          <input type="password" id="authLoginPw" placeholder="비밀번호" autocomplete="current-password" />
          <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem;">
            <button type="button" class="auth-link-btn" id="btnFindId" style="background: none; border: none; color: var(--accent); cursor: pointer; padding: 0;">아이디 찾기</button>
            <button type="button" class="auth-link-btn" id="btnFindPw" style="background: none; border: none; color: var(--accent); cursor: pointer; padding: 0;">비밀번호 찾기</button>
          </div>
          <button type="button" class="btn-auth-submit" id="btnAuthLogin">로그인</button>
          <div class="auth-divider">
            <span>또는</span>
          </div>
          <button type="button" class="btn-social btn-kakao" id="btnKakaoLogin">
            <span>카카오로 시작하기</span>
          </button>
          <button type="button" class="btn-social btn-google" id="btnGoogleLogin">
            <span>구글로 시작하기</span>
          </button>
        </div>
        <div id="authSignupPanel" class="auth-panel" style="display:none;">
          <label>닉네임</label>
          <input type="text" id="authSignupNick" placeholder="2~12자" maxlength="12" inputmode="text" autocomplete="username" />
          <label>이메일 <span style="color: #ef4444;">*</span></label>
          <input type="email" id="authSignupEmail" placeholder="example@email.com" required inputmode="email" autocomplete="email" />
          <label>비밀번호</label>
          <input type="password" id="authSignupPw" placeholder="6자 이상" autocomplete="new-password" />
          <label>비밀번호 확인</label>
          <input type="password" id="authSignupPw2" placeholder="다시 입력" autocomplete="new-password" />
          <button type="button" class="btn-auth-submit" id="btnAuthSignup">가입하기</button>
          <div class="auth-divider">
            <span>또는</span>
          </div>
          <button type="button" class="btn-social btn-kakao" id="btnKakaoSignup">
            <span>카카오로 시작하기</span>
          </button>
          <button type="button" class="btn-social btn-google" id="btnGoogleSignup">
            <span>구글로 시작하기</span>
          </button>
        </div>
        <div id="authFindIdPanel" class="auth-panel" style="display:none;">
          <label>이메일</label>
          <input type="email" id="authFindIdEmail" placeholder="가입 시 입력한 이메일" inputmode="email" autocomplete="email" />
          <button type="button" class="btn-auth-submit" id="btnFindIdSubmit">아이디 찾기</button>
          <div id="findIdResult" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-soft); border-radius: var(--radius); display: none;"></div>
          <button type="button" class="auth-link-btn" id="btnBackToLogin" style="width: 100%; margin-top: 0.5rem; background: none; border: none; color: var(--accent); cursor: pointer; padding: 0.5rem;">← 로그인으로 돌아가기</button>
        </div>
        <div id="authFindPwPanel" class="auth-panel" style="display:none;">
          <label>이메일</label>
          <input type="email" id="authFindPwEmail" placeholder="가입 시 입력한 이메일" inputmode="email" autocomplete="email" />
          <button type="button" class="btn-auth-submit" id="btnFindPwSubmit">비밀번호 재설정 링크 발송</button>
          <div id="findPwResult" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-soft); border-radius: var(--radius); display: none;"></div>
          <div id="authResetPwPanel" style="display:none; margin-top: 1rem;">
            <label>재설정 토큰</label>
            <input type="text" id="authResetToken" placeholder="이메일로 받은 토큰 입력" />
            <label>새 비밀번호</label>
            <input type="password" id="authResetPw" placeholder="6자 이상" autocomplete="new-password" />
            <label>새 비밀번호 확인</label>
            <input type="password" id="authResetPw2" placeholder="다시 입력" autocomplete="new-password" />
            <button type="button" class="btn-auth-submit" id="btnResetPwSubmit">비밀번호 재설정</button>
          </div>
          <button type="button" class="auth-link-btn" id="btnBackToLogin2" style="width: 100%; margin-top: 0.5rem; background: none; border: none; color: var(--accent); cursor: pointer; padding: 0.5rem;">← 로그인으로 돌아가기</button>
        </div>
        
        <button type="button" class="auth-close" id="authClose" aria-label="닫기">✕</button>
      </div>
    </div>
    
    <!-- 동물 선택 모달 -->
    <div class="auth-overlay" id="petSelectOverlay" style="display:none;" role="dialog" aria-modal="true">
      <div class="pet-select-modal">
        <h2 class="auth-title">동물 친구 선택하기</h2>
        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">걸음을 걸어 함께 성장할 동물 친구를 선택해주세요!</p>
        <div class="pet-grid" id="petGrid"></div>
        <button type="button" class="btn-auth-submit" id="btnConfirmPet" style="margin-top: 1rem;">선택하기</button>
        <button type="button" class="auth-close" id="petSelectClose" aria-label="닫기">✕</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="alert"></div>

  
  <script src="app.js"></script>
</body>
</html>
